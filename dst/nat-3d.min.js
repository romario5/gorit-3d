(function(){"use strict";var o=Math.abs,d=Math.sin,l=Math.cos,_=Math.PI,c=Math.sqrt;function e(){return u++}function r(e,r,t){return Math.max(r,Math.min(t,e))}function t(e){return e*s}function a(){let e=performance.now(),r=e-S;S=e;for(let e=0;e<L.length;e++)L[e](r);for(let e in B)B.hasOwnProperty(e)&&B[e](r);I++,1e3<=e-H&&(H=e,T=I,I=0),requestAnimationFrame(a)}function n(e,r,t,a,n){return{vertices:[e,0,r,e+t,0,r,e+t,0,r+a,e,0,r+a],indices:[n+0,n+1,n+3,n+2,n+3,n+1],polygon:[n+0,n+1,n+2,n+3],normals:[0,0,1,0,0,1,0,0,1,0,0,1],textCoords:[0,1]}}let u=1;class g{constructor(r){this.id=e(),this.name=r,this.objects={},this.seeThrough=!1}addObject(e){this.objects[e.id]=e}removeObject(e){delete this.objects[e.id]}}class p{constructor(){this.handlers={},this.namedHandlers={}}getChannel(e){return{on:(r,t)=>{this.namedHandlers.hasOwnProperty(e)||(this.namedHandlers[e]={}),this.namedHandlers[e][r]=t}}}on(e,r){this.handlers.hasOwnProperty(e)||(this.handlers[e]=[]),this.handlers[e].push(r)}trigger(e,r,...t){if(this.handlers.hasOwnProperty(e))for(let a=0;a<this.handlers[e].length;a++)this.handlers[e][a].call(r,...t);if(this.handlers.hasOwnProperty(e))for(let a in this.namedHandlers[e])this.namedHandlers[e][a].call(r,...t)}}class f{constructor(e,r,t){this._x=e||0,this._y=r||0,this._z=t||0,this._eventsHub=new p}onChange(e,r){r===void 0?this._eventsHub.on("change",e):this._eventsHub.getChannel(r).on("change",e)}setValues(e,r,t){return this._x=e,this._y=r,this._z=t,this._eventsHub.trigger("change",this,this),this}copyValuesFrom(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._eventsHub.trigger("change",this,this),this}magnitude(){return c(this._x*this._x+this._y*this._y+this._z*this._z)}squaredMagnitude(){return this._x*this._x+this._y*this._y+this._z*this._z}normalize(){let e=this.magnitude();return this._x/=e,this._y/=e,this._z/=e,this._eventsHub.trigger("change",this,this),this}multiply(e){return this._x*=e,this._y*=e,this._z*=e,this._eventsHub.trigger("change",this,this),this}cross(e){let r=this.clone();return this._x=r.y*e.z-r.z*e.y,this._y=r.z*e.x-r.x*e.z,this._z=r.x*e.y-r.y*e.x,this._eventsHub.trigger("change",this,this),this}dot(e){return this._x*e.x+this._y*e.y+this._z+e.z}add(e){return"object"==typeof e?(this._x+=e.x,this._y+=e.y,this._z+=e.z):(this._x+=e,this._y+=e,this._z+=e),this._eventsHub.trigger("change",this,this),this}sub(e){return"object"==typeof e?(this._x-=e.x,this._y-=e.y,this._z-=e.z):(this._x-=e,this._y-=e,this._z-=e),this._eventsHub.trigger("change",this,this),this}invert(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._eventsHub.trigger("change",this,this),this}clone(){return new f(this._x,this._y,this._z)}applyQuaternion(e){let r=this.x,t=this.y,a=this.z,n=e.x,i=e.y,o=e.z,s=e.w,d=s*r+i*a-o*t,l=s*t+o*r-n*a,_=s*a+n*t-i*r;var c=-n*r-i*t-o*a;return this._x=d*s+c*-n+l*-o-_*-i,this._y=l*s+c*-i+_*-n-d*-o,this._z=_*s+c*-o+d*-i-l*-n,this._eventsHub.trigger("change",this,this),this}toArray(){return[this._x,this._y,this._z]}}f.prototype.isVector3=!0,Object.defineProperty(f.prototype,"x",{get(){return this._x},set(e){this._x=e,this._eventsHub.trigger("change",this,this)},enumerable:!0}),Object.defineProperty(f.prototype,"y",{get(){return this._y},set(e){this._y=e,this._eventsHub.trigger("change",this,this)},enumerable:!0}),Object.defineProperty(f.prototype,"z",{get(){return this._z},set(e){this._z=e,this._eventsHub.trigger("change",this,this)},enumerable:!0});class h{constructor(e){this.prefix=e||"Gorit3D: "}error(e){console.log(this.prefix+e)}info(e){console.log(this.prefix+e)}warn(e){console.warn(this.prefix+e)}}for(var v=new h,x=[],b=0;256>b;b++)x[b]=(16>b?"0":"")+b.toString(16);let s=180/_;class m{constructor(e){this.data=Array.isArray(e)?e:[]}}let y=new f(0,1,0),w=new f(0,0,0),z=new f(1,1,1);class E extends m{constructor(e){super(e)}clone(){let e=[];for(let r=0;r<=this.data.length;r++)e[r]=this.data[r];return new E(e)}copyValuesFrom(e){for(let r=0;16>r;r++)this.data[r]=e.data[r]}multiply(e){let r=this.data,t=e.data;var a=r[0],n=r[1],i=r[2],o=r[3],s=r[4],d=r[5],l=r[6],_=r[7],c=r[8],u=r[9],g=r[10],p=r[11],f=r[12],h=r[13],m=r[14],y=r[15],v=t[0],x=t[1],b=t[2],w=t[3],z=t[4],E=t[5],R=t[6],A=t[7],C=t[8],F=t[9],L=t[10],B=t[11],S=t[12],H=t[13],I=t[14],T=t[15];return this.data=[v*a+x*s+b*c+w*f,v*n+x*d+b*u+w*h,v*i+x*l+b*g+w*m,v*o+x*_+b*p+w*y,z*a+E*s+R*c+A*f,z*n+E*d+R*u+A*h,z*i+E*l+R*g+A*m,z*o+E*_+R*p+A*y,C*a+F*s+L*c+B*f,C*n+F*d+L*u+B*h,C*i+F*l+L*g+B*m,C*o+F*_+L*p+B*y,S*a+H*s+I*c+T*f,S*n+H*d+I*u+T*h,S*i+H*l+I*g+T*m,S*o+H*_+I*p+T*y],this}inverse(){let e=this.data;var r=e[0],t=e[1],a=e[2],n=e[3],i=e[4],o=e[5],s=e[6],l=e[7],_=e[8],c=e[9],u=e[10],g=e[11],p=e[12],f=e[13],h=e[14],m=e[15],y=u*m,v=h*g,x=s*m,b=h*l,w=s*g,z=u*l,E=a*m,R=h*n,A=a*g,C=u*n,F=a*l,L=s*n,B=_*f,S=p*c,H=i*f,I=p*o,T=i*c,P=_*o,O=r*f,U=p*t,M=r*c,N=_*t,Y=r*o,V=i*t,D=y*o+b*c+w*f-(v*o+x*c+z*f),j=v*t+E*c+C*f-(y*t+R*c+A*f),Q=x*t+R*o+F*f-(b*t+E*o+L*f),X=z*t+A*o+L*c-(w*t+C*o+F*c),G=1/(r*D+i*j+_*Q+p*X);return e[0]=G*D,e[1]=G*j,e[2]=G*Q,e[3]=G*X,e[4]=G*(v*i+x*_+z*p-(y*i+b*_+w*p)),e[5]=G*(y*r+R*_+A*p-(v*r+E*_+C*p)),e[6]=G*(b*r+E*i+L*p-(x*r+R*i+F*p)),e[7]=G*(w*r+C*i+F*_-(z*r+A*i+L*_)),e[8]=G*(B*l+I*g+T*m-(S*l+H*g+P*m)),e[9]=G*(S*n+O*g+N*m-(B*n+U*g+M*m)),e[10]=G*(H*n+U*l+Y*m-(I*n+O*l+V*m)),e[11]=G*(P*n+M*l+V*g-(T*n+N*l+Y*g)),e[12]=G*(H*u+P*h+S*s-(T*h+B*s+I*u)),e[13]=G*(M*h+B*a+U*u-(O*u+N*h+S*a)),e[14]=G*(O*s+V*h+I*a-(Y*h+H*a+U*s)),e[15]=G*(Y*u+T*a+N*s-(M*s+V*u+P*a)),this}compose(e,r,t){let a=this.data,n=r._x,i=r._y,o=r._z,s=r._w,d=n+n,l=i+i,_=o+o,c=n*d,u=n*l,g=n*_,p=i*l,f=i*_,h=o*_,m=s*d,y=s*l,v=s*_,x=t.x,b=t.y,w=t.z;return a[0]=(1-(p+h))*x,a[1]=(u+v)*x,a[2]=(g-y)*x,a[3]=0,a[4]=(u-v)*b,a[5]=(1-(c+h))*b,a[6]=(f+m)*b,a[7]=0,a[8]=(g+y)*w,a[9]=(f-m)*w,a[10]=(1-(c+p))*w,a[11]=0,a[12]=e.x,a[13]=e.y,a[14]=e.z,a[15]=1,this}}E.createTranslation=function(e,r,t){return e.isVector3&&(r=e._y,t=e._z,e=e._x),new E([1,0,0,0,0,1,0,0,0,0,1,0,e,r,t,1])},E.createXRotation=function(e){var r=l(e),t=d(e);return new E([1,0,0,0,0,r,t,0,0,-t,r,0,0,0,0,1])},E.createYRotation=function(e){var r=l(e),t=d(e);return new E([r,0,-t,0,0,1,0,0,t,0,r,0,0,0,0,1])},E.createZRotation=function(e){var r=l(e),t=d(e);return new E([r,t,0,0,-t,r,0,0,0,0,1,0,0,0,0,1])},E.createScaling=function(e,r,t){return new E([e,0,0,0,0,r,0,0,0,0,t,0,0,0,0,1])},E.createProjection=function(e,r,t){return new E([2/e,0,0,0,0,-2/r,0,0,0,0,2/t,0,-1,1,0,1])},E.createPerspective=function(e,r,t,a){var n=Math.tan;let i=[];var o=n(.5*_-.5*e),s=1/(r-t);return i[0]=o/a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=(r+t)*s,i[11]=-1,i[12]=0,i[13]=0,i[14]=2*(r*t*s),i[15]=0,new E(i)},E.lookAt=function(e,r){r===void 0&&(r=y);var t=e.clone();0===t.squaredMagnitude()&&(console.log("change direction"),t.z=1),t.normalize();var a=r.clone().cross(t);0===a.squaredMagnitude()&&(1===o(r.z)?t.x+=1e-4:t.z+=1e-4,t.normalize(),a=t.clone().cross(r)),a.normalize();let n=t.clone().cross(a);return new E([a.x,a.y,a.z,0,n.x,n.y,n.z,0,t.x,t.y,t.z,0,0,0,0,1])},E.createRotationAxis=function(e,r){let a=l(r),n=d(r),i=1-a,t=e.x,o=e.y,s=e.z,_=i*t,c=i*o,u=new E;return u.data=[_*t+a,_*o-n*s,_*s+n*o,0,_*o+n*s,c*o+a,c*s-n*t,0,_*s-n*o,c*s+n*t,i*s*s+a,0,0,0,0,1],u},E.createFromQuaternion=function(e){let r=new E;return r.compose(w,e,z)};class R extends f{constructor(e,r,t,a){super(e,r,t),this._order=a===void 0?"XYZ":a.toUpperCase(),this._eventsHub=new p}inDegrees(){return new R(t(this.x),t(this.y),t(this.z),this.order)}copyValuesFrom(e){return this._x=vector.x,this._y=vector.y,this._z=vector.z,void 0!==e.order&&(this._order=vector.order),this._eventsHub.trigger("change",this,this),this}setFromRotationMatrix(e,t,a){var n=Math.atan2,i=Math.asin,s=e.data,d=s[0],l=s[4],_=s[8],c=s[1],u=s[5],g=s[9],p=s[2],f=s[6],h=s[10];return t=t||this._order,"XYZ"===t?(this._y=i(r(_,-1,1)),.9999999>o(_)?(this._x=n(-g,h),this._z=n(-l,d)):(this._x=n(f,u),this._z=0)):"YXZ"===t?(this._x=i(-r(g,-1,1)),.9999999>o(g)?(this._y=n(_,h),this._z=n(c,u)):(this._y=n(-p,d),this._z=0)):"ZXY"===t?(this._x=i(r(f,-1,1)),.9999999>o(f)?(this._y=n(-p,h),this._z=n(-l,u)):(this._y=0,this._z=n(c,d))):"ZYX"===t?(this._y=i(-r(p,-1,1)),.9999999>o(p)?(this._x=n(f,h),this._z=n(c,d)):(this._x=0,this._z=n(-l,u))):"YZX"===t?(this._z=i(r(c,-1,1)),.9999999>o(c)?(this._x=n(-g,u),this._y=n(-p,d)):(this._x=0,this._y=n(_,h))):"XZY"===t?(this._z=i(-r(l,-1,1)),.9999999>o(l)?(this._x=n(f,u),this._y=n(_,d)):(this._x=n(-g,h),this._y=0)):v.warn("Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==a&&this._eventsHub.trigger("change",this,this),this}setFromQuaternion(e,r,t){let a=E.createFromQuaternion(e);return this.setFromRotationMatrix(a,r,t)}reorder(){}}R.prototype.isEuler=!0,Object.defineProperty(R.prototype,"order",{get(){return this._order},set(e){this._order=e.toUpperCase(),this._eventsHub.trigger("change",this,this)},enumerable:!0});class A{constructor(e,r,t,a){this._x=e===void 0?0:e,this._y=r===void 0?0:r,this._z=t===void 0?0:t,this._w=a===void 0?1:a,this._eventsHub=new p}onChange(e,r){r===void 0?this._eventsHub.on("change",e):this._eventsHub.getChannel(r).on("change",e)}setValues(e,r,t,a){return this._x=e||this._x,this._y=r||this._y,this._z=t||this._z,this._w=a||this._w,this._eventsHub.trigger("change",this,this),this}copyValuesFrom(e){this._x=e.x,this._y=e.y,this._z=e.z,e.w!==void 0&&(this._w=e.w),this._eventsHub.trigger("change",this,this)}setFromEuler(e,r){e.isEuler||e.isVector3||v.error("Quaternion: argument given in .setFromEuler() is not an Euler or Vector3.");let t=e._x,a=e._y,n=e._z,i=e.isEuler?e.order:"XYZ",o=l,s=d,_=o(t/2),c=o(a/2),u=o(n/2),g=s(t/2),p=s(a/2),f=s(n/2);return"XYZ"===i?(this._x=g*c*u+_*p*f,this._y=_*p*u-g*c*f,this._z=_*c*f+g*p*u,this._w=_*c*u-g*p*f):"YXZ"===i?(this._x=g*c*u+_*p*f,this._y=_*p*u-g*c*f,this._z=_*c*f-g*p*u,this._w=_*c*u+g*p*f):"ZXY"===i?(this._x=g*c*u-_*p*f,this._y=_*p*u+g*c*f,this._z=_*c*f+g*p*u,this._w=_*c*u-g*p*f):"ZYX"===i?(this._x=g*c*u-_*p*f,this._y=_*p*u+g*c*f,this._z=_*c*f-g*p*u,this._w=_*c*u+g*p*f):"YZX"===i?(this._x=g*c*u+_*p*f,this._y=_*p*u+g*c*f,this._z=_*c*f-g*p*u,this._w=_*c*u-g*p*f):"XZY"===i&&(this._x=g*c*u-_*p*f,this._y=_*p*u-g*c*f,this._z=_*c*f+g*p*u,this._w=_*c*u+g*p*f),!1!==r&&this._eventsHub.trigger("change",this,this),this}setFromAxisAngle(e,r){let t=r/2,a=d(t);return this._x=e.x*a,this._y=e.y*a,this._z=e.z*a,this._w=l(t),this._eventsHub.trigger("change",this,this),this}setFromRotationMatrix(e){let r,t=e.data,a=t[0],n=t[4],i=t[8],o=t[1],d=t[5],l=t[9],_=t[2],u=t[6],g=t[10],p=a+d+g;return 0<p?(r=.5/c(p+1),this._w=.25/r,this._x=(u-l)*r,this._y=(i-_)*r,this._z=(o-n)*r):a>d&&a>g?(r=2*c(1+a-d-g),this._w=(u-l)/r,this._x=.25*r,this._y=(n+o)/r,this._z=(i+_)/r):d>g?(r=2*c(1+d-a-g),this._w=(i-_)/r,this._x=(n+o)/r,this._y=.25*r,this._z=(l+u)/r):(r=2*c(1+g-a-d),this._w=(o-n)/r,this._x=(i+_)/r,this._y=(l+u)/r,this._z=.25*r),this._eventsHub.trigger("change",this,this),this}setFromUnitVectors(e,t){let a=e.dot(t)+1;return a<1e-6?o(e.x)>o(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=0):(this._x=0,this._y=-e.z,this._z=e.y,this._w=0):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=a),this.normalize()}magnitude(){return c(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.magnitude();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x*=e,this._y*=e,this._z*=e,this._w*=e),this._eventsHub.trigger("change",this,this),this}multiply(e){var r=this._x,t=this._y,a=this._z,n=this._w,i=e._x,o=e._y,s=e._z,d=e._w;return this._x=r*d+n*i+t*s-a*o,this._y=t*d+n*o+a*i-r*s,this._z=a*d+n*s+r*o-t*i,this._w=n*d-r*i-t*o-a*s,this._eventsHub.trigger("change",this,this),this}}A.prototype.isQuaternion=!0,Object.defineProperty(A.prototype,"x",{get(){return this._x},set(e){this._x=e,this._eventsHub.trigger("change",this,this)},enumerable:!0}),Object.defineProperty(A.prototype,"y",{get(){return this._y},set(e){this._y=e,this._eventsHub.trigger("change",this,this)},enumerable:!0}),Object.defineProperty(A.prototype,"z",{get(){return this._z},set(e){this._z=e,this._eventsHub.trigger("change",this,this)},enumerable:!0}),Object.defineProperty(A.prototype,"w",{get(){return this._w},set(e){this._w=e,this._eventsHub.trigger("change",this,this)},enumerable:!0});class C{constructor(r){this.id=e(),this.name=r||"",this.meshes={},this.position=new f,this.rotation=new R,this.scale=new f,this._rotationQ=new A,this.rotation.onChange(r=>{this._rotationQ.setFromEuler(r,!1)}),this._rotationQ.onChange(e=>{this.rotation.setFromQuaternion(e)}),this.constraints=[],this.helpers=new g,this.visibleHelpers=new g}addHelper(e,r){r=!0===r,this.helpers.addObject(e),r&&this.visibleHelpers.addObject(e)}removeHelper(e){this.helpers.removeObject(e),this.visibleHelpers.removeObject(e)}rotateByQuaternion(e){this._rotationQ.multiply(e)}addConstraint(e){this.constraints.push(e)}addMesh(e){this.meshes[e.id]=e}removeMesh(e){delete this.meshes[e.id]}getTranslationMatrix(){return E.createTranslation(this.position)}getRotationMatrix(){return E.createFromQuaternion(this._rotationQ)}getTransformationMatrix(){let e=E.createTranslation(this.position);return e.multiply(E.createFromQuaternion(this._rotationQ)),e}applyConstraints(e){for(let r=0;r<this.constraints.length;r++)this.constraints[r].applyTransformations(e)}render(e,r,t){let a=r.clone().multiply(this.getTransformationMatrix());for(let n in this.applyConstraints(a),this.meshes)this.meshes[n].render(e,a,t);for(let a in this.helpers.objects)this.helpers.objects[a].render(e,r,t)}}class F{constructor(e,r,t){this.x=e||0,this.y=r||0,this.z=t||0,this.normal=new f}clone(){return new F(this.x,this.y,this.z)}applyTransform(){}}let L=[],B={},S=performance.now(),H=S,I=0,T=0;class P{constructor(e,r){this.name=r,this.handler=e,this.start()}stop(){if(name===void 0){for(let e=0;e<L;e++)if(L[e]===this.handler){L.splice(e,1);break}}else delete B[this.name]}start(){this.name===void 0?L.push(this.handler):B[this.name]=this.handler}getFPS(){return T}}P.getFPS=function(){return T},a();class O{constructor(e){if(void 0===e)return v.error("GLContext: container is not specified for the viewport."),!1;var r=document.createElement("div");r.style.position="relative",r.style.width="150px",r.style.height="150px",r.style.marginLeft="-150px",r.style.marginTop="-150px",r.style.top="150px",r.style.left="150px",r.style.padding="10px",r.style.userSelect="none",r.style.pointerEvents="none",r.style.fontFamily="monospace",r.style.fontSize="12px",r.style.color="#333";var t=document.createTextNode("");r.appendChild(t),e.appendChild(r),this.container=e,this.canvas=document.createElement("canvas"),this.canvas.style.display="block",this.container.appendChild(this.canvas);let a=this.canvas.getContext("webgl",{antialias:!1,premultipliedAlpha:!1});if(this.context=a,this.canvas.style.width="100%",this.canvas.style.maxWidth="100%",this.canvas.style.height="100%",this.canvas.style.maxHeight="100%",!a)return alert("WebGL is not available. Please enable it."),!1;this.loop=new P(()=>{this.resizeCanvas(),t.textContent="FPS: "+this.loop.getFPS()}),this.onRotate=null,this.onZoom=null,this.onMove=null,this.onMouseDown=null,this.onMouseUp=null;let n=!1,i=!1,o=!1,s=!1,d=0,l=0;this.canvas.addEventListener("mousedown",e=>{n=0===e.button,i=1===e.button,o=2===e.button,d=e.clientX,l=e.clientY,s=!0,null!==this.onMouseDown&&this.onMouseDown(d,l)}),document.addEventListener("mouseup",()=>{n=!1,i=!1,o=!1,null!==this.onMouseUp&&this.onMouseUp(deltaX,deltaY)}),document.addEventListener("mousemove",e=>{let r=d-e.clientX,t=l-e.clientY;o&&null!==this.onRotate&&this.onRotate(r,t),n&&null!==this.onMove&&this.onMove(r,t),i&&null!==this.onZoom&&this.onZoom(r,t),d=e.clientX,l=e.clientY}),document.addEventListener("contextmenu",e=>{s&&e.preventDefault(),s=!1})}getContext(){return this.context}resizeCanvas(){let e=this.context,r=e.canvas.clientWidth,t=e.canvas.clientHeight;(e.canvas.width!=r||e.canvas.height!=t)&&(e.canvas.width=r,e.canvas.height=t,this.width=r,this.height=t)}}const U=1,M=2;class N{constructor(e,r){this.source=e,this.type=r===U?U:M,this.shader=null,this.attributes={},this.varyings={},this.uniforms={},this.parseSource()}getShader(e){if(null!==this.shader)return this.shader;let r=e.createShader(this.type===U?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(e.shaderSource(r,this.source),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){let t=e.getShaderInfoLog(r);v.error("Could not compile WebGL shader. \n\n"+t)}return this.shader=r,r}prepareForRendering(){for(let e in this.attributes);}parseSource(){let e=this.source.search(/void\s+main\s*\(\)/i);0>e&&v.error("Error on shader parsing: unable to find main function.");let r=this.source.slice(0,e).split("\n"),t=!1;for(let e,a=0;a<r.length;a++){if(e=r[a].trim(),t){"*/"===e.slice(-2)&&(t=!1);continue}if("//"===e.slice(0,2))continue;if("/*"===e.slice(0,2)){t=!0;continue}if(""===e)continue;let n=e.indexOf(" ");if(0>n)continue;let i=e.slice(0,n).split(" ");"uniform"===i[0]&&Object.defineProperty(this.uniforms,i[1],{value:1})}}}N.TYPE_VERTEX=1,N.TYPE_FRAGMENT=2,N.U_WIRE_COLOR="u_wireColor",N.U_DIFFUSE_COLOR="u_diffuseColor",N.U_SPECULAR_COLOR="u_specularColor",N.U_LIGHT_COLOR="u_lightColor",N.U_RIM_COLOR="u_rimColor",N.U_VIEW_MATRIX="u_viewMatrix",N.U_PROj_MATRIX="u_projMatrix",N.U_LIGHT_VECTOR="u_lightVector",N.U_LIGHT_REV_DIR="u_reverseLightDirection",N.A_POSITION="a_position",N.A_NORMAL="a_normal";class Y{constructor(e,r,t,n){this._r=e||0,this._g=r||0,this._b=t||0,this._a=n||1,Object.defineProperty(this,"r",{get(){return this._r},set(e){this._r=e,this._eventsHub.trigger("change",this,this)},enumerable:!0}),Object.defineProperty(this,"g",{get(){return this._g},set(e){this._g=e,this._eventsHub.trigger("change",this,this)},enumerable:!0}),Object.defineProperty(this,"b",{get(){return this._b},set(e){this._b=e,this._eventsHub.trigger("change",this,this)},enumerable:!0}),Object.defineProperty(this,"a",{get(){return this._a},set(e){this._a=e,this._eventsHub.trigger("change",this,this)},enumerable:!0}),this._eventsHub=new p,this._array=new Float32Array([this._r,this._g,this._b,this._a])}onChange(e,r){r===void 0?this._eventsHub.on("change",e):this._eventsHub.getChannel(r).on("change",e)}copyValuesFrom(e){this._r=e.r,this._g=e.g,this._b=e.b,this._a=e.a,this._eventsHub.trigger("change",this,this)}asArray(){return this._array[0]=this._r,this._array[1]=this._g,this._array[2]=this._b,this._array[3]=this._a,this._array}setFromArray(e){this._r=0<e.length?e[0]:this._r,this._g=1<e.length?e[1]:this._g,this._b=2<e.length?e[2]:this._b,this._a=3<e.length?e[3]:this._a}}Y.HELPERS=new Y(1,.75,.1,1);class V{constructor(e){e||(e={});let r=[],t=null,a=!1;this.wireColor=e.wireColor||new Y(.7,.7,.7,0),this.getProgram=function(){return t},this.addShader=function(e){return e instanceof N||v.error("Given shader is not and instance of Shader class."),r.push(e),this},this.compileShaders=function(e){if(!a){t=e.createProgram();for(let a=0;a<r.length;a++)e.attachShader(t,r[a].getShader(e));if(e.linkProgram(t),!e.getProgramParameter(t,e.LINK_STATUS)){let r=e.getProgramInfoLog(t);throw"Could not compile WebGL program. \n\n"+r}a=!0}return this},this.prepareShaders=function(e){for(let t=0;t<r.length;t++)r[t].prepareForRendering(e);return this}}prepareForRendering(){}}let D=new class extends N{constructor(e){super(e,U)}}("\nattribute vec4 a_position;\nattribute vec3 a_normal;\n\nuniform mat4 u_matrix;\n\nvarying vec3 v_normal;\nvarying vec3 v_position;\n\nvoid main() {\n  // Multiply the position by the matrix.\n  gl_Position = u_matrix * a_position;\n  v_position = a_position.xyz;\n\n  // Pass the normal to the fragment shader\n  v_normal = a_normal;\n}\n");let j=new class extends N{constructor(e){super(e,M),this.setPositionsAttributeName=function(){}}}("\nprecision mediump float;\n\n// Passed in from the vertex shader.\nvarying vec3 v_normal;\n\nuniform vec3 u_reverseLightDirection;\nuniform vec4 u_diffuseColor;\nuniform vec4 u_wireColor;\n\nvoid main() {\n  // because v_normal is a varying it's interpolated\n  // we it will not be a uint vector. Normalizing it\n  // will make it a unit vector again\n  vec3 normal = normalize(v_normal);\n\n  float light = dot(normal, u_reverseLightDirection);\n\n  gl_FragColor = u_diffuseColor;\n  \n\n  // Lets multiply just the color portion (not the alpha)\n  //  by the light\n  gl_FragColor.rgb *= light;\n\n  if (u_wireColor[3] > 0.0) {\n      gl_FragColor = u_wireColor;\n  }\n}\n");class Q extends V{constructor(e){super(e),e||(e={}),this.diffuseColor=e.color||new Y(.5,.5,.5,1),this.specular=1,this.glossiness=.5,this.addShader(D),this.addShader(j)}prepareForRendering(e){let r=this.getProgram(),t=e.getUniformLocation(r,N.U_DIFFUSE_COLOR),a=e.getUniformLocation(r,N.U_WIRE_COLOR);e.uniform4fv(t,this.diffuseColor.asArray()),e.uniform4fv(a,this.wireColor.asArray())}}class X{constructor(r){this.id=e(),this.vertices=[],this.textureVertices=[],this.uv=[],this.normals=[],this.polygons=[],this.facesIndices=[],this.wireframeIndices=[],this.material=new Q,this.cachedMesh=r||null,this.position=new f,this.rotation=new f,this.verticesBuffer=null,this.normalsBuffer=null,this.indicesBuffer=null,this.wireBuffer=null,this.updateBuffers=!0}getVertex(e,r){if(void 0===r&&(r=this.transformMatrix),null!==this.cachedMesh)return this.cachedMesh.getVertex(e,r);if(this.vertices.length>3*e+4);let t=new F(this.vertices[e],this.vertices[e+1],this.vertices[e+2]);return t.applyTransform(r)}getPolygon(){}getFace(){}prepareForRendering(e,r){null===this.verticesBuffer&&(this.verticesBuffer=r.createBuffer()),this.updateBuffers&&(r.bindBuffer(r.ARRAY_BUFFER,this.verticesBuffer),r.bufferData(r.ARRAY_BUFFER,new Float32Array(this.vertices),r.STATIC_DRAW)),(null===this.normalsBuffer||this.updateBuffers)&&(this.normalsBuffer=r.createBuffer()),this.updateBuffers&&(r.bindBuffer(r.ARRAY_BUFFER,this.normalsBuffer),r.bufferData(r.ARRAY_BUFFER,new Float32Array(this.normalsBuffer),r.STATIC_DRAW)),(null===this.indicesBuffer||this.updateBuffers)&&(this.indicesBuffer=r.createBuffer()),this.updateBuffers&&(r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indicesBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.facesIndices),r.STATIC_DRAW)),(null===this.wireBuffer||this.updateBuffers)&&(this.wireBuffer=r.createBuffer()),this.updateBuffers&&(r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.wireBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.wireframeIndices),r.STATIC_DRAW)),this.updateBuffers=!1,r.bindBuffer(r.ARRAY_BUFFER,this.verticesBuffer);let t=r.getAttribLocation(e,"a_position");r.enableVertexAttribArray(t),r.vertexAttribPointer(t,3,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this.normalsBuffer);var a=r.getAttribLocation(e,"a_normal");r.enableVertexAttribArray(a),r.vertexAttribPointer(a,3,r.FLOAT,!1,0,0)}makeFinalTransformMatrix(e){return e}render(e,r,t){this.material.compileShaders(e);let a=this.material.getProgram();e.useProgram(a),this.material.wireColor.a=0,this.material.prepareForRendering(e),this.prepareForRendering(a,e);let n=e.getUniformLocation(a,"u_matrix");r=this.makeFinalTransformMatrix(r,t),e.uniformMatrix4fv(n,!1,r.data),this.draw(e),!0===t.wireframe&&(this.material.wireColor.a=1,this.material.prepareForRendering(e),this.drawWire(e))}draw(e){e.bindBuffer(e.ARRAY_BUFFER,this.verticesBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indicesBuffer),e.drawElements(e.TRIANGLES,this.facesIndices.length,e.UNSIGNED_SHORT,0)}drawWire(e){let r=e.isEnabled(e.CULL_FACE);e.disable(e.CULL_FACE),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.wireBuffer),e.drawElements(e.LINES,this.wireframeIndices.length,e.UNSIGNED_SHORT,0),r&&e.enable(e.CULL_FACE)}}class G extends X{constructor(e){super(),e=e||{},this.applyParameters(e),this.generateMesh()}applyParameters(){}generateMesh(){}}let k=new N("\nprecision mediump float;\n\nuniform vec4 u_diffuseColor;\n\nvoid main() {\n  gl_FragColor = u_diffuseColor;\n}\n",M);class Z extends V{constructor(e){super(),this.addShader(D),this.addShader(k),e instanceof Y?this.color=e:(this.color=new Y(1,1,1,1),Array.isArray(e)&&this.color.setFromArray(e))}prepareForRendering(e){let r=this.getProgram(),t=e.getUniformLocation(r,N.U_DIFFUSE_COLOR);e.uniform4fv(t,this.color.asArray())}}class W extends G{constructor(){super(),this.material=new Z([1,.75,.1,1])}applyParameters(e){e===void 0&&(e={}),this.size=e.size||1}generateMesh(){let e=this.size;this.vertices=[0,0,0,-e,-e,-e,-e,e,-e,e,e,-e,e,-e,-e,-e,-e,-e,0,1.35*e,-e],this.facesIndices=[0,1,2,0,3,2,0,4,3,0,5,4,0,2,6,3]}draw(e){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indicesBuffer),e.drawElements(e.LINE_STRIP,this.facesIndices.length,e.UNSIGNED_SHORT,0),e.drawElements(e.TRIANGLE_STRIP,3,e.UNSIGNED_SHORT,26)}}class q extends G{constructor(e){super(e),this.material=new Z([1,.75,.1,1])}applyParameters(e){e===void 0&&(e={}),this.size=e.size||10}generateMesh(){let e=this.size/2;this.vertices=[-e,-e,-e,e,-e,-e,e,-e,-e,e,e,-e,e,e,-e,-e,e,-e,-e,e,-e,-e,-e,-e,-e,e,-e,-e,e,e,-e,e,e,-e,-e,e,-e,-e,e,-e,-e,-e,-e,e,e,e,e,e,e,e,e,e,-e,e,e,-e,e,-e,-e,e,e,e,e,e,e,-e,e,-e,-e,e,-e,e]}draw(e){e.bindBuffer(e.ARRAY_BUFFER,this.verticesBuffer),e.drawArrays(e.LINES,0,this.vertices.length/3)}}class K extends G{constructor(e){super(e),this.material=new Z([1,.75,.1,1]),this.start.onChange(()=>this.generateMesh()),this.end.onChange(()=>this.generateMesh()),this.color.onChange(e=>this.material.color=e.asArray())}applyParameters(e){this.color=new Y(1,.75,.1,1),this.start=new f,this.end=new f,e!==void 0&&e.color instanceof Y&&this.color.copyValuesFrom(e.color)}generateMesh(){this.vertices=[this.start.x,this.start.y,this.start.z,this.end.x,this.end.y,this.end.z],this.updateBuffers=!0}draw(e){e.bindBuffer(e.ARRAY_BUFFER,this.verticesBuffer),e.drawArrays(e.LINES,0,this.vertices.length/3)}}class J extends C{constructor(e){function r(){let e=this.position.clone().sub(this.target.position),r=E.lookAt(e);this._rotationQ.setFromRotationMatrix(r)}super(e),this.position.x=15,this.position.y=15,this.position.z=15,this.targeted=!1,this.fieldOfView=45,this.near=.1,this.far=2e4,this.aspectRatio=1;let t=new C,a=new K({color:new Y(1,.75,.1,1)});t.addMesh(a),this.addHelper(t,!1);let n=new C("Camera"),i=new W({size:1});n.addMesh(i),this.addHelper(n,!1),this.target=new C("Target");let o=new q({size:.1});this.target.addMesh(o),this.addHelper(this.target,!0),this.rotation.onChange(()=>{n._rotationQ.copyValuesFrom(this._rotationQ)}),this.position.onChange(e=>{n.position.copyValuesFrom(e),a.start.copyValuesFrom(e),this.targeted&&r.call(this)}),this.position.x=this.position.x,this.target.position.onChange(e=>{a.end.copyValuesFrom(e),this.targeted&&r.call(this)}),this.target.x=this.target.x,r.call(this)}getCameraMatrix(){return E.createTranslation(this.position).multiply(E.createFromQuaternion(this._rotationQ))}getViewMatrix(){return this.getCameraMatrix().clone().inverse()}getProjectionMatrix(){return E.createPerspective(this.fieldOfView,this.near,this.far,this.aspectRatio)}}let $=new N("\nprecision mediump float;\n\nuniform vec4 u_gridColor;\nuniform vec4 u_xColor;\nuniform vec4 u_yColor;\nuniform vec4 u_zColor;\n\nfloat len;\n\nvarying vec3 v_position;\n\nvoid main() {\n  len = sqrt(v_position.x*v_position.x + v_position.y*v_position.y + v_position.z*v_position.z);\n  \n  \n\n  gl_FragColor = u_gridColor;\n\n  if (v_position.x == 0.0 && v_position.z == 0.0) {\n    gl_FragColor = u_yColor;\n  }\n\n  if (v_position.y == 0.0 && v_position.z == 0.0) {\n    gl_FragColor = u_xColor;\n  }\n\n  if (v_position.x == 0.0 && v_position.y == 0.0) {\n    gl_FragColor = u_zColor;\n  }\n\n  if (len > 15.0) {\n    len = (1.0 - ((len - 15.0) / 10.0))/1.0 * gl_FragColor.a;\n    if (len < 0.0) {\n      len = 0.0;\n    }\n    gl_FragColor.a = len;\n  }\n}\n",M);class ee extends V{constructor(e){super(e),this.addShader(D),this.addShader($),this.gridColor=e.gridColor||new Y(.22,.25,.28,1),this.xAxisColor=new Float32Array([.75,.15,0,1]),this.yAxisColor=new Float32Array([0,.75,0,1]),this.zAxisColor=new Float32Array([0,.25,.75,1])}prepareForRendering(e){let r=this.getProgram(),t=e.getUniformLocation(r,"u_gridColor"),a=e.getUniformLocation(r,"u_xColor"),n=e.getUniformLocation(r,"u_yColor"),i=e.getUniformLocation(r,"u_zColor");e.uniform4fv(t,this.gridColor.asArray()),e.uniform4fv(a,this.xAxisColor),e.uniform4fv(n,this.yAxisColor),e.uniform4fv(i,this.zAxisColor)}}class re extends G{constructor(e){super(e),this.material=new ee(e)}applyParameters(e){this.width=e.width||50,this.height=e.height||50,this.edgesX=e.edgesX||50,this.edgesY=e.edgesY||50}generateMesh(){var e=Math.floor;let r=[],t=[],a=e(this.width/this.edgesX),n=e(this.height/this.edgesY),i=this.width/2,o=this.height/2,s=0;for(let e=0;e<this.edgesY+1;e++)r.push(-i,0,e*n-o),r.push(i,0,e*n-o),t.push(s++,s++);for(let e=0;e<this.edgesX+1;e++)r.push(e*a-i,0,-o),r.push(e*a-i,0,o),t.push(s++,s++);this.vertices=r,this.facesIndices=t}draw(e){e.bindBuffer(e.ARRAY_BUFFER,this.verticesBuffer),e.drawArrays(e.LINES,0,this.vertices.length/3)}}class te extends G{constructor(e){super(e),this.material=new ee({color:[1,1,1,1]})}applyParameters(e){this.size=e.size||50}generateMesh(){let e=this.size/2;this.vertices=[e,0,0,-e,0,0,0,0,e,0,0,-e],this.facesIndices=[0,1,2,3,4,5]}draw(e){e.bindBuffer(e.ARRAY_BUFFER,this.verticesBuffer),e.drawArrays(e.LINES,0,this.vertices.length/3)}}class ae{constructor(r){r===void 0&&(r={}),this.id=e(),this.name=r.name||"Viewport "+this.id,this.x=r.x||0,this.y=r.y||0,this.width=r.width||ae.defaultWidth,this.height=r.height||ae.defaultHeight,this.flexible=!1!==r.flexible,this.showGrid=!1!==r.showGrid,this.background=r.background||ae.defaultBackground,this.container=r.container||null,this.helpersContainer=new g,this.defaultCamera=new J("viewport"),this.camera=this.defaultCamera,this.projectViewMatrix=null,this.grid=new C;let t=new re({width:50,height:50,gridColor:new Y(.5,.5,.5,.25)});this.grid.addMesh(t),this.axisGuides=new C;let a=new te({size:50});this.axisGuides.addMesh(a),this.showHelpers=!0,this.wireframe=!0,this.cullFace=!0,this.grow=!0===r.grow,this.background=r.background||null,this.handleEvents=!0===r.handleEvents,this.rotate=(()=>{let e=new f(0,1,0),r=new f(1,0,0),t=new A,a=new A,n=new f;return(i,o)=>{this.handleEvents&&(e.setValues(0,1,0),r.setValues(1,0,0),r.applyQuaternion(this.camera._rotationQ).normalize(),a.setFromAxisAngle(r,.005*o),t.setFromAxisAngle(e,.005*i),n.copyValuesFrom(this.camera.position).sub(this.camera.target.position).applyQuaternion(a).applyQuaternion(t).add(this.camera.target.position),this.camera.position.copyValuesFrom(n),r.setValues(1,0,0),a.setFromAxisAngle(r,.005*o),this.camera._rotationQ.multiply(a),t.multiply(this.camera._rotationQ),this.camera._rotationQ.copyValuesFrom(t))}})(),this.onMouseDown=()=>{}}renderGrid(e){this.grid.render(e,this.projectViewMatrix,this),this.axisGuides.render(e,this.projectViewMatrix,this)}renderScene(e,r){for(let t in this.adjustSize(r),r.enable(r.DEPTH_TEST),this.cullFace&&r.enable(r.CULL_FACE),r.enable(r.POLYGON_OFFSET_FILL),r.polygonOffset(2,3),this.projectViewMatrix=this.camera.getProjectionMatrix().multiply(this.camera.getViewMatrix()),this.showHelpers&&this.renderGrid(r),e.layers){let a=e.layers[t].objects;for(let e in a)a[e]!==this.camera&&a[e].render(r,this.projectViewMatrix,this)}}adjustSize(e){let r=e.canvas,t=r.clientWidth,a=r.clientHeight;this.grow&&(this.width=t,this.height=a);var n=this.width/this.height;this.camera.aspectRatio=n,(r.width!==t||r.height!==a)&&(r.width=t,r.height=a),e.viewport(this.x,this.y,this.width,this.height),e.scissor(this.x,this.y,this.width,this.height),null!==this.background&&(e.clearColor(this.background.r,this.background.g,this.background.b,this.background.a),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT))}zoom(e,r){if(this.handleEvents){let e=this.camera.position.clone().sub(this.camera.target.position);e.multiply(.005*-r);let t=e.magnitude();.01>t&&0!==t&&(e.normalize().multiply(.01),t=.01),this.camera.position.add(e),t=e.clone().copyValuesFrom(this.camera.position).sub(this.camera.target.position).magnitude(),.01>t&&this.camera.target.position.add(e)}}move(e,r){if(this.handleEvents){let t=new f(1,0,0),a=new f(0,1,0),n=t.copyValuesFrom(this.camera.position).sub(this.camera.target.position).magnitude(),i=n/10;.25>i&&(i=.25),t.setValues(1,0,0),t.applyQuaternion(this.camera._rotationQ).multiply(.01*e*i),a.applyQuaternion(this.camera._rotationQ).multiply(.01*-r*i),this.camera.position.add(t),this.camera.position.add(a),this.camera.target.position.add(t),this.camera.target.position.add(a)}}}ae.defaultWidth=400,ae.defaultHeight=300,ae.defaultBackground="#fff",ae.MODE_FLAT=1,ae.MODE_SHADED=2,ae.MODE_REALISTIC=3;class ne extends g{constructor(e){super(e)}}class ie{constructor(e){this.name=e,this.layers={},this.layersByName={},this.currentLayer=new ne("Default layer"),this.addLayer(this.currentLayer)}addLayer(e){this.layers[e.id]=e,this.layersByName[e.name]=e}addObject(e,r){void 0===r&&(r="default");let t=this.getLayer(r);if(null===t){let e=Object.keys(this.layers);if(0===e.length)return!1;t=this.layers[e[0]]}return t.addObject(e),!0}getLayer(e){return this.layers.hasOwnProperty(e)?this.layers[e]:null}getLayerByName(e){return this.layersByName.hasOwnProperty(e)?this.layersByName[e]:null}}class oe{constructor(e){this.file=e}readFile(){return new Promise((e,r)=>{let t=new FileReader;t.onload=()=>{let r=t.result.indexOf(";base64,");return 0<=r?e(this.parse(atob(t.result.slice(r+8)))):void e(this.parse(t.result))},t.onerror=r,t.readAsDataURL(this.file)})}parse(){return null}}class se extends oe{constructor(e){super(e)}parse(e){let r=new X,t=e.split("\n");for(let a,n=0,i=t.length;n<i;n++){if(a=t[n].trim(),"#"===a[0])continue;let e=a.split(" "),i=e.shift();if("v"===i)for(let t=0;t<e.length;t++)r.vertices.push(parseFloat(e[t]));else if("f"===i){let t=[];for(let a,n=0;n<e.length;n++)a=e[n].split("/"),t.push(parseInt(a[0])-1),2<n?(r.facesIndices.push(t[n-1]),r.facesIndices.push(t[n]),r.facesIndices.push(t[0])):r.facesIndices.push(t[n]),1<n?(r.wireframeIndices.push(t[n-1]),r.wireframeIndices.push(t[n]),n==e.length-1&&(r.wireframeIndices.push(t[n]),r.wireframeIndices.push(t[0]))):r.wireframeIndices.push(t[n])}else"o"===i&&(r.name=e[0])}return r}}class de{constructor(){this.opacity=1,this.bias=1,this.samples=10}}class le extends C{constructor(){super(),this.intensity=10,this.shadow=new de,this.color=new f(1,1,1)}}class _e extends G{constructor(e){super(e),this.name=e.name||"Point light mesh",e===void 0&&(e={}),e.color||(e.color=Y.HELPERS),this.material=new Z(e.color),this.matrix=new E,this.up=new f(0,1,0),this.xAxis=new f,this.yAxis=new f,this.zAxis=new f,this.lookAtMatrix=new E}applyParameters(e){e===void 0&&(e={}),this.size=e.size||2,this.interpolation=e.interpolation||10,this.secondCircleOffset=0}generateMesh(){this.vertices=[];let e=2/(this.interpolation-1),t=this.size/2,a=2*_,n=0;for(let r=0;r<=a;r+=e)this.vertices.push(t*d(r),t*l(r),0),0<n&&this.facesIndices.push(n-1,n),n++;this.secondCircleOffset=this.vertices.length,t=this.size/2.5,n=0;for(let r=0;r<=a;r+=e)this.vertices.push(t*d(r),t*l(r),0),0<n&&this.facesIndices.push(n-1,n),n++}makeFinalTransformMatrix(e,r){return this.matrix.copyValuesFrom(e),this.zAxis.setValues(e.data[12],e.data[13],e.data[14]).sub(r.camera.position).normalize(),this.lookAtMatrix=E.createFromQuaternion(r.camera._rotationQ),this.matrix.multiply(this.lookAtMatrix)}draw(e){let r=e.isEnabled(e.CULL_FACE);e.disable(e.CULL_FACE),e.bindBuffer(e.ARRAY_BUFFER,this.verticesBuffer),e.drawArrays(e.LINE_LOOP,0,this.secondCircleOffset/3),e.drawArrays(e.TRIANGLE_FAN,this.secondCircleOffset/3,(this.vertices.length-this.secondCircleOffset)/3),r&&e.enable(e.CULL_FACE)}}window.NAT={App:class{constructor(){this.viewports={},this.viewportByName={},this.scenes={},this.canvas=null,this.currentScene=null,this.stopped=!1,this.loop=new P(()=>{if(!(this.stopped||null===this.currentScene)){let e=this.canvas.context;for(let r in e.enable(e.SCISSOR_TEST),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.viewports)this.viewports[r].renderScene(this.currentScene,e)}})}addViewport(e){this.viewports[e.id]=e,this.viewportByName[e.name]=e}getViewport(){}init(e){if(null===this.canvas){this.canvas=new O(e);let r=new ae({name:"Default",x:0,y:0,width:400,height:200,grow:!0,handleEvents:!0});this.addViewport(r),this.currentScene=this.createScene("default"),this.canvas.onMouseDown=(e,r)=>{for(let t in this.viewports)this.viewports[t].onMouseDown(e,r)},this.canvas.onRotate=(e,r)=>{for(let t in this.viewports)this.viewports[t].rotate(e,r)},this.canvas.onZoom=(e,r)=>{for(let t in this.viewports)this.viewports[t].zoom(e,r)},this.canvas.onMove=(e,r)=>{for(let t in this.viewports)this.viewports[t].move(e,r)}}}getContext(){return this.canvas.context}createScene(e){if(this.scenes.hasOwnProperty(e))return v.warn("App: scene with name \""+e+"\" already exists."),null;let r=new ie(e);return this.scenes[e]=r,null===this.currentScene&&(this.currentScene=r),r}activateScene(e){return this.scenes.hasOwnProperty(e)?(this.currentScene=this.scenes[e],!0):(v.warn("App: scene with name \""+e+"\" is absent."),!1)}},Viewport:ae,Object3D:C,Vector3:f,Quaternion:A,FramesLoop:P,Camera:J,Color:Y,meshes:{Cube:class extends G{constructor(e){super(e),this.material=new Z([1,0,1,1])}applyParameters(e){this.size=e.size||100}generateMesh(){let e=this.size/2||.5,r=[[-e,-e,-e],[+e,-e,-e],[-e,+e,-e],[+e,+e,-e],[-e,-e,+e],[+e,-e,+e],[-e,+e,+e],[+e,+e,+e]],t=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],a=[[1,0],[0,0],[0,1],[1,1]];this.polygons=[[3,7,5,1],[6,2,0,4],[6,7,3,2],[0,1,5,4],[7,6,4,5],[2,3,1,0]];let n=[],i=[],o=[],s=[];for(let e=0;6>e;e++){const d=this.polygons[e];for(let s=0;4>s;s++){const l=r[d[s]],_=t[e],c=a[s];i.push(...l),n.push(..._),o.push(...c)}const l=4*e;s.push(l+0,l+1,l+2),s.push(l+0,l+2,l+3)}this.vertices=i,this.facesIndices=s,this.normals=n,this.textureCoords=o}draw(e){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indicesBuffer),e.drawElements(e.LINE_LOOPS,this.facesIndices.length,e.UNSIGNED_SHORT,0)}},Plane:class extends G{constructor(e){super(e)}applyParameters(e){this.width=e.width||200,this.height=e.height||200,this.edgesX=e.edgesX||1,this.edgesY=e.edgesY||1}generateMesh(){let e=[],r=[],t=[],a=[],i=this.width/this.edgesX,o=this.height/this.edgesY,s=0,l=!1;for(let _=0;_<this.edgesX+1;_++){for(let c=0;c<this.edgesY+1;c++){let u=l?this.edgesY-c:c,g=-this.width/2+i*_,p=-this.height/2+o*u,f=n(g,p,i,o,s);s+=4,e.push(...f.vertices),r.push(f.polygon),t.push(...f.indices),a.push(...f.normals)}l=!l}this.vertices=e,this.polygons=r,this.facesIndices=t,this.normals=a}}},lights:{PointLight:class extends le{constructor(e){super(e),this.name=e.name||"Point light";let r=new C,t=new _e(e);r.addMesh(t),this.helpers.addObject(r),this.position.onChange(e=>{r.position.copyValuesFrom(e)})}},DirectLight:null,SpotLight:null},readFile(e){let r=e.name.split(".").pop().toLowerCase(),t=null;return"obj"===r?t=new se(e):void 0,null===t?void v.error("Unsupported file extension ("+r+")"):t.readFile()}}})();
//# sourceMappingURL=nat-3d.min.js.map
